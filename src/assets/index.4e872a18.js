import{k as I,i as v,J as g,C as O,L as B,c as M,h as q,K as Q,g as L,_ as W,G as d,H as E,I as N,f as H,M as i,N as m,O as _,Q as b,R as y,F as k,S,U as P,V as x}from"./index.217e6a9a.js";import{Q as V}from"./QPageContainer.ea8637dd.js";import{_axios as z}from"./axios.5152fdf9.js";var A=I({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(t,{slots:e}){const{proxy:{$q:o}}=L(),s=v(O,g);if(s===g)return console.error("QPage needs to be a deep child of QLayout"),g;if(v(B,g)===g)return console.error("QPage needs to be child of QPageContainer"),g;const a=M(()=>{const l=(s.header.space===!0?s.header.size:0)+(s.footer.space===!0?s.footer.size:0);if(typeof t.styleFn=="function"){const c=s.isContainer.value===!0?s.containerHeight.value:o.screen.height;return t.styleFn(l,c)}return{minHeight:s.isContainer.value===!0?s.containerHeight.value-l+"px":o.screen.height===0?l!==0?`calc(100vh - ${l}px)`:"100vh":o.screen.height-l+"px"}}),r=M(()=>`q-page${t.padding===!0?" q-layout-padding":""}`);return()=>q("main",{class:r.value,style:a.value},Q(e.default))}}),K={getStatus(t,e,o){z.get("/home/state").then(s=>{t(s.data)}).catch(s=>{console.log(s)})}};const j={name:"RainglowDisplay",props:{},data(){return{row:null,polarPositions:[{angleDeg:-90,radius:120},{angleDeg:-30,radius:120},{angleDeg:30,radius:120},{angleDeg:90,radius:120},{angleDeg:150,radius:120},{angleDeg:210,radius:120}]}},created(){K.getStatus(this.processData,null)},computed:{currentBlock(){const t=new Date().getHours();return Math.floor(t/4)},formattedTemp(){if(!this.row||this.row.temp_c==null)return"--";const t=Number(this.row.temp_c);return isNaN(t)?"--":t.toFixed(1)},centerStyle(){if(!this.row)return{};const t=Number(this.row.r_c||0),e=Number(this.row.g_c||0),o=Number(this.row.b_c||0);return{backgroundColor:"rgb("+t+", "+e+", "+o+")"}},segments(){const t=this.row;if(!t)return[];const e=[],o=120,s=190;for(let n=0;n<6;n++){const r=this.polarPositions[n].angleDeg*Math.PI/180,l=o*Math.cos(r)-12,c=o*Math.sin(r)-10,p=s*Math.cos(r),f=s*Math.sin(r),h=Number(t["dayOffset_"+n]||0),u=Number(t["probRain_"+n]||0),w=Number(t["rainMM_"+n]||0),D=String(t["timeStart_"+n]||""),C=String(t["timeEnd_"+n]||""),T=Number(t["r_"+n]||0),R=Number(t["g_"+n]||0),F=Number(t["b_"+n]||0);e.push({index:n,dayOffset:h,probRain:u,rainMm:w,timeStart:D,timeEnd:C,colorStyle:{backgroundColor:"rgb("+T+", "+R+", "+F+")"},positionStyle:{transform:"translate("+l+"px,"+c+"px)"},infoStyle:{transform:"translate(-50%, -50%) translate("+p+"px,"+f+"px)"}})}return e},centerRainAlert(){if(!this.row)return!1;let t=0,e=0;for(let o=this.currentBlock;o<6;o++){if(Number(this.row["dayOffset_"+o]||0)!==0)continue;const n=Number(this.row["probRain_"+o]||0),a=Number(this.row["rainMM_"+o]||0);n>t&&(t=n),e+=a}return t>=60||e>=5},summaryText(){if(!this.row)return"";const t={totalMm:0,maxProb:0,earliestWetIndex:null},e={totalMm:0,maxProb:0,earliestWetIndex:null},o=.2,s=40;for(let c=0;c<6;c++){const p=Number(this.row["dayOffset_"+c]||0),f=Number(this.row["probRain_"+c]||0),h=Number(this.row["rainMM_"+c]||0),u=p===0?t:p===1?e:null;if(!u)continue;u.totalMm+=h,f>u.maxProb&&(u.maxProb=f),(h>=o||f>=s)&&u.earliestWetIndex==null&&(u.earliestWetIndex=c)}const n=t.totalMm>=o,a=e.totalMm>=o,r=this.describeDay("today",t),l=this.describeDay("tomorrow",e);return!n&&!a?"Mostly dry today and tomorrow.":n&&!a?r+" Tomorrow looks mostly dry.":!n&&a?"Today is mostly dry. "+l:r+" "+l}},methods:{processData(t){console.log(t),this.row=t},blockToPeriod(t){switch(t){case 0:return"overnight";case 1:return"early morning";case 2:return"late morning";case 3:return"afternoon";case 4:return"evening";case 5:return"late evening";default:return""}},describeDay(t,e){const o=e.totalMm,s=e.maxProb,n=e.earliestWetIndex;if(o<.2)return t==="today"?"Today is mostly dry.":"Tomorrow is mostly dry.";const a=o.toFixed(1),r=s.toFixed(0)+"%";let l="showers";o>=5?l="heavy rain":o>=2&&(l="rain"),console.log(l);const c=n!=null?this.blockToPeriod(n):"at times";return t==="today"?"Showers today ("+a+"mm, up to "+r+", mainly "+c+").":"Showers tomorrow ("+a+"mm, up to "+r+", mainly "+c+")."}}},G={class:"q-pa-md fit rainglow-wrapper bg-black"},J={key:0,class:"text-white"},U={key:1,class:"rainglow-ring-container"},X={class:"rainglow-ring"},Y={class:"center-temp"},Z={class:"outer-led-time"},$={class:"outer-led-meta"},tt={class:"q-ml-xs"},et={key:0,class:"q-mt-sm text-body2 rg-summary q-mt-xl desktop-only",style:{"margin-top":"100px"}},rt={class:"q-mt-md text-caption desktop-only text-white"},ot={key:0};function nt(t,e,o,s,n,a){return d(),E(V,{class:"fit"},{default:N(()=>[H(A,{class:"fit bg-black justify-center flex"},{default:N(()=>[i("div",G,[e[5]||(e[5]=i("div",{class:"text-subtitle1 q-mb-sm hidden"}," RainGlow \u2013 Current Light State ",-1)),n.row?(d(),m("div",U,[i("div",X,[e[0]||(e[0]=i("div",{class:"ring-outline ring-outline-outer"},null,-1)),e[1]||(e[1]=i("div",{class:"ring-outline ring-outline-inner"},null,-1)),i("div",{class:_(["center-led",{"center-alert":a.centerRainAlert}]),style:b(a.centerStyle)},[i("div",Y,y(a.formattedTemp)+"\xB0C ",1)],6),(d(!0),m(k,null,S(a.segments,r=>(d(),m("div",{key:"dot-"+r.index,class:"outer-led",style:b(r.positionStyle)},[i("div",{class:_(["outer-led-dot",{"is-current":r.index===a.currentBlock}]),style:b(r.colorStyle)},null,6)],4))),128)),(d(!0),m(k,null,S(a.segments,r=>(d(),m("div",{key:"info-"+r.index,class:"outer-led-info desktop-only text-white",style:b(r.infoStyle)},[i("div",Z,y(r.timeStart)+"\u2013"+y(r.timeEnd),1),i("div",$,[i("span",{class:_(["day-tag",r.dayOffset===0?"day-today":"day-tomorrow"])},y(r.dayOffset===0?"T":"+1"),3),i("span",tt,y(r.probRain.toFixed(0))+"% \u2022 "+y(r.rainMm.toFixed(1))+"mm ",1)])],4))),128))]),a.summaryText?(d(),m("div",et,y(a.summaryText),1)):P("",!0),i("div",rt,[e[3]||(e[3]=i("div",{class:"text-center"},[i("span",{class:"legend-box legend-current"}),x(" Blinking outer LED = current time interval ")],-1)),e[4]||(e[4]=i("div",{class:"text-center"},[i("span",{class:"legend-box legend-today"}),x(" Today \xA0\xA0 "),i("span",{class:"legend-box legend-tomorrow"}),x(" Tomorrow ")],-1)),a.centerRainAlert?(d(),m("div",ot,[...e[2]||(e[2]=[i("span",{class:"legend-dot legend-center"},null,-1),x(" Centre pulsing = rain alert (from now onwards today) ",-1)])])):P("",!0)])])):(d(),m("div",J," No data loaded. "))])]),_:1})]),_:1})}var lt=W(j,[["render",nt],["__scopeId","data-v-701836be"]]);export{lt as default};
